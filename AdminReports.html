<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Reports - Adhira Trust</title>
<link rel="stylesheet" href="css/style.css">

<style>
table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}
th, td{
    padding:10px;
    border:1px solid #ccc;
    text-align:left;
}
th{
    background:#7b2cbf;
    color:white;
}
.name-link{
    color:#5a189a;
    cursor:pointer;
    font-weight:bold;
}
.address-row{
    background:#f9f0ff;
}
</style>
</head>

<body>

<div id="navbar-placeholder"></div>

<section style="max-width:1100px;margin:40px auto;">
    <h2 style="color:#5a189a;text-align:center;">Admin Dashboard</h2>
    <h2></h2>

    <div style="text-align:center;">
        <button onclick="loadDonors()" style="
            padding:12px 30px;
            background:#7b2cbf;
            color:white;
            border:none;
            border-radius:6px;
            cursor:pointer;
            font-size:16px;">
            Donors List
        </button>
    </div>

    <div id="donorTable"></div>
</section>

<footer id="bank-details">
    <h3>Donation Details</h3>

    <div class="bank-details">
        <p><strong>Account Name:</strong> Adhira Trust</p>
        <p><strong>SB Account No:</strong> 3912500100787601</p>
        <p><strong>IFSC:</strong> KARB0000391</p>
        <p><strong>Branch:</strong> Kumbakonam</p>
        <p><strong>MICR:</strong> 612052002</p>
    </div>

    <p style="margin-top:20px;">
        Donations are eligible for tax exemption under Section 80G.
    </p>

    <p>
        Thank you for standing with Adhira Trust in spiritual sevas and acts of charity.
    </p>
</footer>

<script src="js/script.js"></script>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzeZlTH3V7DroZtX83oEmvvXytG1M5vVVxzhRr-lG5XpDtoSjdiDMgA_YelMF3qAZkm/exec";

// Protect page
if(localStorage.getItem("adminLoggedIn") !== "true"){
    window.location.href = "admin.html";
}
function loadDonors(){

    const formData = new URLSearchParams();
    formData.append("action", "getDonors");

    fetch(scriptURL, {
        method: "POST",
        body: formData
    })
    .then(res => res.json())
    .then(data => {

        if(data.status === "success"){

            let html = `
            <table>
            <tr>
                <th>Name</th>
                <th>Mobile</th>
                <th>WhatsApp</th>
                <th>Email</th>
                <th>Donation For</th>
                <th>PAN</th>
                <th>Monthly Contact</th>
            </tr>
            `;

            data.donors.forEach((d, index) => {

                html += `
                <tr>
                    <td class="name-link" onclick="toggleAddress(${index})">${d.name}</td>
                    <td>${d.mobile}</td>
                    <td>${d.whatsapp}</td>
                    <td>${d.email}</td>
                    <td>${d.donationFor}</td>
                    <td>${d.pan}</td>
                    <td>${d.monthlyContact}</td>
                </tr>

                <tr id="address-${index}" class="address-row" style="display:none;">
                    <td colspan="7">
                        <strong>Address:</strong><br>
                        ${d.address1}<br>
                        ${d.address2}<br>
                        ${d.city}, ${d.state} - ${d.pincode}
                    </td>
                </tr>
                `;
            });

            html += "</table>";

            document.getElementById("donorTable").innerHTML = html;
        }
        else{
            alert("No Data Received");
        }

    })
    .catch(error => {
        console.error(error);
        alert("Server Error while loading donors");
    });
}

</script>
    


    
<script>    
function toggleAddress(index){
    const row = document.getElementById("address-"+index);
    row.style.display = row.style.display === "none" ? "table-row" : "none";
}
</script>

</body>
</html>
